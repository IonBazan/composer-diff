#!/usr/bin/env php
<?php

foreach ([__DIR__.'/../../autoload.php', __DIR__.'/../autoload.php', __DIR__.'/vendor/autoload.php'] as $file) {
    if (file_exists($file)) {
        require_once $file;
        break;
    }
}

unset($file);

use Composer\Composer;
use Composer\Package\CompletePackage;
use IonBazan\ComposerDiff\Command\DiffCommand;
use IonBazan\ComposerDiff\PackageDiff;
use Symfony\Component\Console\Application;

if (!class_exists(Application::class)) {
    echo 'Please install symfony/console >= 5.4.1 to use this binary or use composer diff instead.'.PHP_EOL;
    exit(1);
}

if (!class_exists(CompletePackage::class) || !version_compare(Composer::VERSION, '2.2.0', '>=')) {
    echo 'Please install composer/composer >= 2.2 to use this binary or use composer diff instead.'.PHP_EOL;
    exit(1);
}

$application = new Application();
$application->add(new DiffCommand(new PackageDiff()));
$application->setDefaultCommand('diff', true);
$application->run();
